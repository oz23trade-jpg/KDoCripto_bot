# render.yaml — Blueprint для деплоя K DoCripto на Render.com
# Два сервиса: backend (FastAPI API) + bot (aiogram worker)

services:

  # 1. Backend — FastAPI API
  - type: web
    name: kdocripto-api
    env: python
    plan: free
    branch: main
    repo: https://github.com/oz23trade-jpg/KDoCripto_bot
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      PIP_ONLY_BINARY: ":all:"
      # DATABASE_URL — добавь вручную из Supabase или Render Postgres
      # ADMIN_IDS:
      #   sync: false                         # секрет, вводи вручную

  # 2. Telegram Bot — aiogram polling (Background Worker)
  - type: worker
    name: kdocripto-bot                         # ← дефис для стиля
    env: python
    plan: free
    branch: main
    repo: https://github.com/oz23trade-jpg/KDoCripto_bot
    rootDir: bot
    buildCommand: pip install -r requirements.txt
    startCommand: python main.py
    envVars:
      BOT_TOKEN:
        sync: false                             # секрет, вводи вручную
      API_BASE_URL:
        fromService:
          name: kdocripto-api
          type: web
          property: url                         # Render подставит https://kdocripto-api.onrender.com
      # ADMIN_IDS:
      #   fromService:
      #     name: kdocripto-api
      #     envVarName: ADMIN_IDS

# База данных — вариант A: PostgreSQL от Render (бесплатно 90 дней, потом ~$7/мес)
# databases:
#   - name: kdocripto-db
#     databaseName: kdocripto
#     user: kdocripto
#     plan: free
#     region: oregon                            # или frankfurt (EU Central)

# Вариант B: Supabase (рекомендую — бесплатно навсегда)
# Удали блок databases выше и добавь вручную в envVars backend:
# DATABASE_URL = postgresql://postgres.[твой-ref]:пароль@db.[твой-ref].supabase.co:5432/postgres
